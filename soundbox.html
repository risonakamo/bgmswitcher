<link rel="import" href="./polymer/polymer-2.0.2/polymer-element.html">

<dom-module id="sound-box">
  <template>
    <style>
      :host
      {
        display: inline-block;
        height: 160px;
        width: auto;
        color: white;
        font-size: 0;
        border-bottom: 2px solid white;
        background-color: #272727;
      }

      div
      {
        display: inline-block;
        vertical-align: top;
      }

      .left
      {
        width: 160px;
        height: 160px;
        line-height: 160px;
        padding: 0 10px 0 10px;
      }

      .left img
      {
        display: inline-block;
        width: 100%;
        vertical-align: middle;
      }

      .right
      {
        width: 213px;
        height: 160px;
        line-height: 160px;
        margin: 0 10px 0 5px;
      }

      #title
      {
        vertical-align: middle;
        line-height: initial;
        font-size: 20px;
      }

      #video
      {
        height: 0;
        width: 0;
        display: none;
      }
    </style>

    <div class="left">
      <img src="https://img.youtube.com/vi/QY1Vetd7OCs/hqdefault.jpg">
    </div>

    <div class="right">
      <div id="title">Let the Battles Begin! - Final Fantasy VII Music Extended</div>
    </div>

    <div id="video"></div>

  </template>

  <script>
    class soundBox extends Polymer.Element
    {
      static get is()
      {
        return "sound-box";
      }

      /*
        ---variables---
        Player player

        ---public functions---
        void vstop()
      */
      static get properties()
      {
        return {

        };
      }

      ready()
      {
        super.ready();

        this.player=new YT.Player(this.$["video"],{
          height:0,width:0,
          videoId:"QY1Vetd7OCs",
          playerVars:{
            loop:1
          }
        });
      }

      vplay(e)
      {
        e.preventDefault();

        if (this.player.getPlayerState()==1)
        {
          return;
        }

        this.player.setVolume(100);
        this.player.seekTo(0);
        this.player.playVideo();
      }

      vstop()
      {
        this.vfade(1000);
      }

      //time to fade out in ms
      //current max 5sec
      vfade(time)
      {
        if (this.player.getPlayerState()!=1)
        {
          return;
        }

        time=10000/time;
        var vol=100;
        var fadeTimer=setInterval(()=>{
          if (vol<=0)
          {
            clearInterval(fadeTimer);
            this.player.pauseVideo();
            return;
          }

          vol-=time;
          vol=Math.floor(vol);
          this.player.setVolume(vol);
        },50);
      }
    }

    customElements.define(soundBox.is,soundBox);
  </script>
</dom-module>